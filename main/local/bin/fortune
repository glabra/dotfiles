#!/bin/sh
set -ue
umask 0027
export PATH='/bin:/usr/bin'
IFS=' 	
'

FORTUNE_FILE="${HOME}/.local/share/fortune.txt"

__fetch () {
	if which curl >/dev/null 2>&1; then
		curl "${1}"
	elif which wget >/dev/null 2>&1; then
		wget -O - "${1}"
	else
		printf 'wget or curl not found.\n'
		exit 1
	fi
}

die () {
	cat <<- _EOF_
	usage: $0 [COMMAND]

	The following commands are available:
	  pick: pick a fortune (default)
	  update: update fortune database
	  help: show this text.
	_EOF_
	exit $1
}

update () {
	(
	url='https://raw.githubusercontent.com/sasairc/yasuna/master/quotes/yasuna-quotes'
	__fetch "${url}" | tail -n +2 | cut -d':' -f3 > "${FORTUNE_FILE}"
	)
}

pick () {
	shuf -n1 "${FORTUNE_FILE}" 2>/dev/null \
		|| printf 'Cannot read dictionary file.\n'
}

case "${1:-}" in
    'pick' | '') pick ;;
    'update') update ;;
    'help') die 0;;
    *) die 1;;
esac

