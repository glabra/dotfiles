#!/bin/sh
set -ue
umask 0027
export PATH='/bin:/usr/bin'
export LANG='C'
IFS='	 
'

connect () {
	jackd -r -d alsa -P hw:2 >&/dev/null &
	sleep 0.1 # wait for jackd initialize
	alsa_in -j alsa_in -d to_jack -r 48000 >&/dev/null &
	sleep 0.1 # wait for alsa_in initialize

	jack_connect alsa_in:capture_1 system:playback_1
	jack_connect alsa_in:capture_2 system:playback_2
}

disconnect () {
	(
	jackdp=$(pgrep 'jackd' || true)
	alsainp=$(pgrep 'alsa_in' || true)
	[ -n "${alsainp}" ] && kill "${alsainp}"
	[ -n "${jackdp}" ] && kill "${jackdp}"
	true
	)
}

disconnect
sleep 0.1 # wait for jackd, alsainp shutdown
connect &
