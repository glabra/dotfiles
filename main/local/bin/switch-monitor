#!/bin/sh
set -ue
umask 0027
export PATH='/bin:/usr/bin'
export LANG='C'
IFS=' 	
'

toggle_audio () {
	(
	INTERNAL_PROFILE=output:analog-stereo
	EXTERNAL_PROFILE=output:hdmi-stereo-extra1

	case "$(ponymix get-profile)" in
		"$INTERNAL_PROFILE")
			ponymix set-profile "${EXTERNAL_PROFILE}"
			;;
		*)
			ponymix set-profile "${INTERNAL_PROFILE}"
			ll
	esac
	)
}

xrandr_action () {
	(
	INTERNAL_MONITOR='eDP1'
	EXTERNAL_MONITOR='HDMI2'
	EXTERNAL_AUDIO='IEC958,1'

	xrandr --output "${EXTERNAL_MONITOR}" --auto --$1 "${INTERNAL_MONITOR}"
	xrandr --listactivemonitors | fgrep -q "${EXTERNAL_MONITOR}" \
		|| amixer sset "${EXTERNAL_AUDIO}" mute
	)
}

case "${1:-}" in
	'right-of'|'same-as')
		xrandr_action $1
		[ -x "${HOME}/.fehbg" ] && "${HOME}/.fehbg"
		;;
	'toggle-audio')
		toggle_audio
		;;
	*)
		printf 'Usage: switch-monitor (right-of|same-as)\n'
		;;
esac
